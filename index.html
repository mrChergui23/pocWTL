<!--  ----------------------------------------------------------------------  -->
<!--  NOTE: Please add the following <META> element to your page <HEAD>.      -->
<!--  If necessary, please modify the charset parameter to specify the        -->
<!--  character set of your HTML page.                                        -->
<!--  ----------------------------------------------------------------------  -->

<head>
    <style>
        body {
            font-family: "Segoe UI", Roboto, Arial, sans-serif;
            background-color: #fff;
            padding: 20px;
        }

        form {
            max-width: 500px;
            margin: auto;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            font-size: 15px;
        }

        .required {
            color: red;
            margin-left: 4px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 12px 14px;
            font-size: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        input[type="submit"] {
            background-color: #FF5800;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        input[type="submit"]:hover {
            background-color: #C8CEC1;
        }

        .button-container {
            text-align: right;
        }

        button {
            background-color: #FF5800;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
    </style>
</head>

<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
<script src="https://www.google.com/recaptcha/api.js"></script>
<script>
    function timestamp() {
        var response = document.getElementById("g-recaptcha-response");
        if (response == null || response.value.trim() == "") {
            var elems = JSON.parse(
                document.getElementsByName("captcha_settings")[0].value
            );
            elems["ts"] = JSON.stringify(new Date().getTime());
            document.getElementsByName("captcha_settings")[0].value =
                JSON.stringify(elems);
        }
    }
    setInterval(timestamp, 500);
</script>
<script>
    function setConsentNewsLetter(checkbox) {
        document.getElementById("consentNewsLetter").value = checkbox.checked ? 'Oui' : 'Non';
    }
</script>
<!--  ----------------------------------------------------------------------  -->
<!--  NOTE: Please add the following <FORM> element to your page.             -->
<!--  ----------------------------------------------------------------------  -->
<body>
<form action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&orgId=00DG5000005SauP" method="POST">
    <input type=hidden name='captcha_settings' value='{"keyname":"AFDAS_PREPROD","fallback":"true","orgId":"00DG5000005SauP","ts":""}'>
    <input type="hidden" name="oid" value="00DG5000005SauP" />
    <input type="hidden" name="retURL" value="https://www.afdas.com" />
    <input type="hidden" id="city" name="city" value="FR" />
    <input type="hidden" id="country_code" name="country_code" value="FR" />
    <input type="hidden" id="lead_source" name="lead_source" value="PageAlternance" />
    <input type="hidden" name="recordType" id="recordType" value="012G5000004L4Bn" />
    <input type="hidden" id="salutation" name="salutation" value="CIV_3" />
    <input type="hidden" id="consentContact" name="00NG500000IDhKb" value="Oui" />
    <input type="hidden" id="consentNewsLetter" name="00NG500000IDhKa" value="Non" />

    <!--  ----------------------------------------------------------------------  -->
    <!--  NOTE: These fields are optional debugging elements. Please uncomment    -->
    <!--  these lines if you wish to test in debug mode.                          -->
    <!--  <input type="hidden" name="debug" value=1>                              -->
    <!--  <input type="hidden" name="debugEmail" value="sf.monitoring@afdas.com"> --> 
    <!--  ----------------------------------------------------------------------  -->

    <label for="last_name">Nom<span class="required">*</span></label>
    <input id="last_name" maxlength="80" name="last_name" size="20" type="text" required /><br />

    <label for="first_name">Prénom<span class="required">*</span></label>
    <input id="first_name" maxlength="80" name="first_name" size="20" type="text" required /><br />

	<label for="email">Adresse e-mail<span class="required">*</span></label>
    <input id="email" maxlength="80" name="email" size="20" type="email" required placeholder="exemple@domaine.com"/>

    <label for="phone">Téléphone<span class="required">*</span></label>
    <input type="tel" id="phone" name="phone" required placeholder="+indicatif pays suivi du numéro" />
	<br />

    <label for="company">Société<span class="required">*</span></label>
    <input id="company" maxlength="80" name="company" size="20" type="text" required /><br />

    <label for="Siren">Siren<span class="required">*</span></label>
	<input id="siren" name="00NG500000IDhKe"
		   type="text"
		   required
		   maxlength="9"
		   minlength="9"
		   size="20"
		   placeholder="123456789" />
	<br />

    <label for="Region">Région<span class="required">*</span></label>
    <select id="00NG500000IDhKd" name="00NG500000IDhKd" title="Région" required>
		<option value="">- Aucun -</option>
		<option value="84">AUVERGNE-RHÔNE-ALPES</option>
		<option value="27">BOURGOGNE-FRANCHE-COMTÉ</option>
		<option value="53">BRETAGNE</option>
		<option value="24">CENTRE-VAL DE LOIRE</option>
		<option value="94">CORSE</option>
		<option value="44">GRAND EST</option>
		<option value="32">HAUTS-DE-FRANCE</option>
		<option value="11">ÎLE-DE-FRANCE</option>
		<option value="28">NORMANDIE</option>
		<option value="75">NOUVELLE-AQUITAINE</option>
		<option value="76">OCCITANIE</option>
		<option value="52">PAYS DE LA LOIRE</option>
		<option value="93">PROVENCE-ALPES-CÔTE D&#39;AZUR</option>
		<option value="01">GUADELOUPE</option>
		<option value="02">MARTINIQUE</option>
		<option value="03">GUYANE</option>
		<option value="04">LA RÉUNION</option>
    </select><br />

    <label>
        <input type="checkbox" id="consent_contact" name="consent_contact" required>
        J'accepte d'être contacté par l'Afdas pour le suivi de ma demande, par téléphone ou par mail.
        <span class="required">*</span>
    </label><br/>

    <label>
        <input type="checkbox" id="consent_newsletter" name="consent_newsletter" onclick="setConsentNewsLetter(this)" >
        J'accepte de recevoir des informations générales de la part de l'Afdas
    </label><br/>

    <div style="display: flex; justify-content: center;">
        <div class="g-recaptcha" data-sitekey="6Le6HvwrAAAAAMSMFfZxEZ-Ko-0BmNCL3RBfv6TA"></div>
    </div> 
    <br />
    <div class="button-container">
        <input type="submit" name="submit" />
    </div>

</form>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    const phoneRegex = /^(\+33[1-9][0-9]{8}|0[1-9][0-9]{8}|\+590[0-9]{9}|\+596[0-9]{9}|\+594[0-9]{9}|\+262[0-9]{9}|\+687[0-9]{6}|\+689[0-9]{6}|\+508[0-9]{6}|\+681[0-9]{6}|\+(?!33|590|596|594|262|687|689|508|681)[1-9][0-9]{6,14})$/;
    const ERRORS = {
        email: "L’adresse email saisie n’est pas au bon format.",
        phone: "Le numéro de téléphone saisi n’est pas valide.",
        siren: "Le SIREN saisi n’est pas reconnu. Vérifiez qu’il contient bien 9 chiffres valides."
    };

    // Algorithme de Luhn (SIREN)
    function isValidLuhn(number) {
        let sum = 0, shouldDouble = false;
        for (let i = number.length - 1; i >= 0; i--) {
            let digit = parseInt(number.charAt(i), 10);
            if (isNaN(digit)) return false;
            if (shouldDouble) {
                digit *= 2;
                if (digit > 9) digit -= 9;
            }
            sum += digit;
            shouldDouble = !shouldDouble;
        }
        return (sum % 10 === 0);
    }
	
    const emailInput = document.getElementById("email");
    const phoneInput = document.getElementById("phone");
    const sirenInput = document.getElementById("siren");
	
	//Reset des erreurs
	emailInput.addEventListener("input", function () {
		emailInput.setCustomValidity("");
	});
	phoneInput.addEventListener("input", function () {
		phoneInput.setCustomValidity("");
	});
	sirenInput.addEventListener("input", function () {
		sirenInput.setCustomValidity("");
	});

    //Vérification Email / Telephone / Siren
    emailInput.addEventListener("blur", function () {
        if (emailInput.value.trim() !== "" && !emailRegex.test(emailInput.value)) {
            emailInput.setCustomValidity(ERRORS.email);
        } else {
            emailInput.setCustomValidity("");
        }
        emailInput.reportValidity();
    });

    phoneInput.addEventListener("blur", function () {
        if (phoneInput.value.trim() !== "" && !phoneRegex.test(phoneInput.value)) {
            phoneInput.setCustomValidity(ERRORS.phone);
        } else {
            phoneInput.setCustomValidity("");
        }
        phoneInput.reportValidity();
    });

    sirenInput.addEventListener("blur", function () {
        const val = sirenInput.value;
        if (val !== "" && (!/^\d{9}$/.test(val) || !isValidLuhn(val))) {
            sirenInput.setCustomValidity(ERRORS.siren);
        } else {
            sirenInput.setCustomValidity("");
        }
        sirenInput.reportValidity();
    });

    // Vérification finale au submit
    form.addEventListener("submit", function (e) {
        let valid = true;
        if (!emailRegex.test(emailInput.value)) {
            emailInput.setCustomValidity(ERRORS.email);
            emailInput.reportValidity();
            valid = false;
        }
        if (!phoneRegex.test(phoneInput.value)) {
            phoneInput.setCustomValidity(ERRORS.phone);
            phoneInput.reportValidity();
            valid = false;
        }
        const sirenVal = sirenInput.value;
        if (!/^\d{9}$/.test(sirenVal) || !isValidLuhn(sirenVal)) {
            sirenInput.setCustomValidity(ERRORS.siren);
            sirenInput.reportValidity();
            valid = false;
        }

        if (!valid) {
            e.preventDefault();
        }
    });
});

</script>
</body>
